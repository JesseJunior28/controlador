{% extends 'ocorrencia/modelo.html' %}

{% load static %}

{% load crispy_forms_tags %}

{% block conteudo %}
<div class="col-6">
  <h1>Cadastrar OcorrÃªncia</h1>

  <form method="post">
    {% csrf_token %}

    {# erros gerais do form #}
    {% if form.non_field_errors %}
      <div class="alert alert-danger">
        <ul class="mb-0">
          {% for err in form.non_field_errors %}
            <li>{{ err }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    {{ form.titulo|as_crispy_field }}


    {{ form.unidade|as_crispy_field }}

    {# agora renderizamos tipo_local via crispy #}
    {{ form.tipo_local|as_crispy_field }}

    <div id="local_interno" style="display:none;">
      {{ form.planta|as_crispy_field }}
      {{ form.ativo|as_crispy_field }}
    </div>

    <div id="local_externo" style="display:none;">
      {{ form.endereco|as_crispy_field }}
      {{ form.localizacao|as_crispy_field }}
    </div>

    {{ form.criticidade|as_crispy_field }}
    {{ form.status|as_crispy_field }}
    {{ form.data_solicitacao|as_crispy_field }}
    {{ form.descricao|as_crispy_field }}

    <div class="d-flex justify-content-between mt-3">
      <a href="{% url 'lista_ocorrencia' %}" class="btn btn-secondary">Cancelar</a>
      <button type="submit" class="btn btn-primary">Salvar</button>
    </div>
  </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const tipo = document.getElementById('id_tipo_local');
  const blocoInt = document.getElementById('local_interno');
  const blocoExt = document.getElementById('local_externo');

  function toggle() {
    if (tipo.value === 'interno') {
      blocoInt.style.display = 'block';
      blocoExt.style.display = 'none';
    } else if (tipo.value === 'externo') {
      blocoInt.style.display = 'none';
      blocoExt.style.display = 'block';
    } else {
      blocoInt.style.display = blocoExt.style.display = 'none';
    }
  }

  tipo.addEventListener('change', toggle);
  toggle();
});
</script>
{% endblock %}

